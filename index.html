<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Maho Architect Studio Pro V4 | Ultra Webhook Designer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5865f2;
            --primary-hover: #4752c4;
            --danger: #f04747;
            --success: #43b581;
            --bg-dark: #0f111a;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #e1e1e1;
            --text-muted: #949ba4;
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }
        body { margin: 0; font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); overflow: hidden; height: 100vh; }

        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 15% 15%, rgba(88, 101, 242, 0.12) 0%, transparent 35%),
                        radial-gradient(circle at 85% 85%, rgba(240, 71, 71, 0.08) 0%, transparent 35%);
            z-index: -1;
        }

        .app-container { display: grid; grid-template-columns: 480px 1fr; height: 100vh; width: 100vw; }

        /* --- Sidebar --- */
        .sidebar { background: rgba(10, 11, 18, 0.9); backdrop-filter: blur(30px); border-right: 1px solid var(--glass-border); display: flex; flex-direction: column; height: 100vh; }
        .sidebar-header { padding: 20px 25px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .toolbar { display: flex; gap: 8px; background: rgba(0,0,0,0.4); padding: 12px 25px; border-bottom: 1px solid var(--glass-border); align-items: center; flex-shrink: 0; }

        .sidebar-content { flex: 1; overflow-y: auto; padding: 25px; scrollbar-width: thin; scrollbar-color: var(--primary) transparent; }
        .sidebar-content::-webkit-scrollbar { width: 5px; }
        .sidebar-content::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        .tool-btn { background: var(--glass-bg); border: 1px solid var(--glass-border); color: white; padding: 8px 14px; border-radius: 6px; cursor: pointer; font-size: 11px; display: flex; align-items: center; gap: 6px; font-weight: 600; text-transform: uppercase; }
        .tool-btn:hover:not(:disabled) { background: var(--primary); border-color: var(--primary); }
        .tool-btn:disabled { opacity: 0.2; cursor: not-allowed; }

        .embed-editor-block { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 14px; padding: 22px; margin-bottom: 40px; position: relative; }
        .embed-number-tag { position: absolute; top: -12px; left: 20px; background: var(--primary); color: white; padding: 3px 12px; border-radius: 20px; font-size: 10px; font-weight: 800; }

        .form-group { margin-bottom: 14px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { display: block; font-size: 9px; font-weight: 800; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        
        input, textarea { width: 100%; background: rgba(0, 0, 0, 0.4); border: 1px solid var(--glass-border); border-radius: 6px; padding: 10px; color: #fff; font-size: 12px; outline: none; }
        input:focus { border-color: var(--primary); }

        /* --- Toast --- */
        #toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 99999; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #2b2d31; border-left: 4px solid var(--primary); color: white; padding: 16px 20px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 12px; min-width: 280px; animation: toastIn 0.3s ease-out forwards; }
        .toast.error { border-left-color: var(--danger); }
        @keyframes toastIn { from { transform: translateX(110%); } to { transform: translateX(0); } }

        /* --- Discord Preview Area --- */
        .preview-pane { background: #313338; display: flex; justify-content: center; overflow-y: auto; padding: 60px 20px; }
        .discord-mockup { width: 100%; max-width: 680px; display: flex; gap: 16px; }
        .bot-avatar { width: 42px; height: 42px; border-radius: 50%; flex-shrink: 0; }
        
        .embed-card { background: #2b2d31; border-left: 4px solid var(--primary); border-radius: 4px; padding: 16px; max-width: 520px; margin-top: 8px; position: relative; }
        .e-author { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 14px; font-weight: 600; }
        .e-author img { width: 24px; height: 24px; border-radius: 50%; }
        .e-thumbnail { position: absolute; top: 16px; right: 16px; width: 80px; height: 80px; border-radius: 4px; object-fit: cover; }
        .e-title { color: #00a8fc; font-weight: 700; font-size: 16px; margin-bottom: 6px; }
        .e-desc { color: #dbdee1; font-size: 14px; white-space: pre-wrap; line-height: 1.4; }
        .e-image { width: 100%; border-radius: 4px; margin-top: 12px; }
        .e-footer { margin-top: 12px; font-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 5px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 10000; }
        .modal-card { background: #161821; border: 1px solid var(--glass-border); width: 420px; padding: 30px; border-radius: 20px; }
    </style>
</head>
<body>

<div id="toast-container"></div>

<div class="modal-overlay" id="field-modal">
    <div class="modal-card">
        <h3>Yeni Alan (Field)</h3>
        <div class="form-group"><label>Alan Ba≈ülƒ±ƒüƒ±</label><input type="text" id="modal-f-name"></div>
        <div class="form-group"><label>Alan ƒ∞√ßeriƒüi</label><textarea id="modal-f-val" rows="3"></textarea></div>
        <div style="display:flex; gap:10px; margin-top:20px">
            <button class="tool-btn" style="flex:1" onclick="closeModal()">ƒ∞ptal</button>
            <button class="tool-btn" style="flex:1; background: var(--primary)" onclick="confirmField()">Kaydet</button>
        </div>
    </div>
</div>

<div class="app-container">
    <div class="sidebar">
        <div class="sidebar-header">
            <h3 style="margin:0">Maho Architect V4</h3>
            <div style="display:flex; gap:8px">
                <button class="tool-btn" onclick="exportData()">üì• Export</button>
                <button class="tool-btn" onclick="document.getElementById('import-file').click()">üì§ Import</button>
                <input type="file" id="import-file" style="display:none" onchange="importData(this)">
            </div>
        </div>
        <div class="toolbar">
            <button class="tool-btn" id="undo-btn" onclick="undo()">‚Ü© Geri</button>
            <button class="tool-btn" id="redo-btn" onclick="redo()">ƒ∞leri ‚Ü™</button>
            <div style="flex:1"></div>
            <button class="tool-btn" onclick="addNewEmbed()" style="color: var(--primary); border-color: var(--primary)">+ Embed Ekle</button>
        </div>
        <div class="sidebar-content">
            <div class="form-group"><label>Webhook URL</label><input type="text" id="hook-url" placeholder="https://discord.com/api/webhooks/..."></div>
            <div class="form-group"><label>Ana Mesaj</label><textarea id="main-content" rows="2" oninput="debouncedSave(); renderPreview()">Maho V4 ile yeni bir duyuru! üöÄ</textarea></div>
            
            <div id="editor-list"></div>

            <button class="tool-btn" style="width:100%; padding:18px; background: var(--primary); font-size:14px" onclick="sendWebhook()">WEBHOOK'U G√ñNDER</button>
            <div style="height: 50px;"></div>
        </div>
    </div>

    <div class="preview-pane">
        <div class="discord-mockup">
            <img src="https://i.imgur.com/AfFp7pu.png" class="bot-avatar">
            <div style="flex:1">
                <div style="margin-bottom:5px"><span style="font-weight:600; color:#fff">Maho Bot</span><span style="background:var(--primary); font-size:10px; padding:2px 4px; border-radius:3px; margin-left:6px; font-weight:700">BOT</span><span style="color:var(--text-muted); font-size:12px; margin-left:8px" id="live-clock">00:00</span></div>
                <div id="p-content" style="color:#dcddde; margin-bottom:8px"></div>
                <div id="p-embed-list"></div>
            </div>
        </div>
    </div>
</div>

<script>
    let history = [];
    let historyStep = -1;
    let embedData = [{
        title: "Mimari Ba≈ülƒ±k", description: "ƒ∞√ßerik buraya gelecek...", color: "#5865f2",
        author: "", authorIcon: "", thumbnail: "", image: "", footer: "", fields: []
    }];
    let activeEmbIdx = 0;
    let saveTimer;

    // Toast Mesajlarƒ±
    function showToast(msg, type = 'success') {
        const c = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = `toast ${type}`;
        t.innerHTML = `<span>${type === 'success' ? '‚úÖ' : '‚ùå'}</span> ${msg}`;
        c.appendChild(t);
        setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 400); }, 3000);
    }

    // Geri-ƒ∞leri & Kayƒ±t Sistemi
    function debouncedSave() { 
        clearTimeout(saveTimer); 
        saveTimer = setTimeout(() => {
            saveState();
            localStorage.setItem('maho_architect_backup', JSON.stringify({
                embedData,
                content: document.getElementById('main-content').value,
                hookUrl: document.getElementById('hook-url').value
            }));
        }, 500); 
    }

    function saveState() {
        const currentState = JSON.stringify({embedData, content: document.getElementById('main-content').value});
        if (historyStep >= 0 && history[historyStep] === currentState) return;
        if (historyStep < history.length - 1) history.splice(historyStep + 1);
        history.push(currentState);
        historyStep++;
        updateToolbar();
    }

    function undo() { if (historyStep > 0) { historyStep--; applyState(); showToast("Geri alƒ±ndƒ±"); } }
    function redo() { if (historyStep < history.length - 1) { historyStep++; applyState(); showToast("ƒ∞leri alƒ±ndƒ±"); } }

    function applyState() {
        const state = JSON.parse(history[historyStep]);
        embedData = state.embedData;
        document.getElementById('main-content').value = state.content;
        renderEditor(); renderPreview(); updateToolbar();
    }

    function updateToolbar() {
        document.getElementById('undo-btn').disabled = (historyStep <= 0);
        document.getElementById('redo-btn').disabled = (historyStep >= history.length - 1);
    }

    // Embed ƒ∞≈ülemleri
    function addNewEmbed() {
        if(embedData.length >= 10) return showToast("Discord limiti 10 embed!", "error");
        embedData.push({ title: "Yeni Ba≈ülƒ±k", description: "", color: "#2f3136", author:"", authorIcon:"", thumbnail:"", image:"", footer:"", fields: [] });
        saveState(); renderEditor(); renderPreview();
        showToast("Embed eklendi");
    }

    function removeEmbed(i) {
        if(embedData.length <= 1) return;
        embedData.splice(i, 1);
        saveState(); renderEditor(); renderPreview();
    }

    function openModal(i) { activeEmbIdx = i; document.getElementById('field-modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('field-modal').style.display = 'none'; }

    function confirmField() {
        const n = document.getElementById('modal-f-name').value;
        const v = document.getElementById('modal-f-val').value;
        if(!n || !v) return;
        embedData[activeEmbIdx].fields.push({name: n, value: v});
        closeModal(); debouncedSave(); renderEditor(); renderPreview();
        document.getElementById('modal-f-name').value = '';
        document.getElementById('modal-f-val').value = '';
    }

    function updateEmbed(i, key, val) {
        embedData[i][key] = val;
        renderPreview();
        debouncedSave();
    }

    // Render Fonksiyonlarƒ±
    function renderEditor() {
        const list = document.getElementById('editor-list');
        list.innerHTML = '';
        embedData.forEach((emb, i) => {
            list.innerHTML += `
                <div class="embed-editor-block">
                    <span class="embed-number-tag">EMBED #${i+1}</span>
                    <div style="display:flex; justify-content:space-between; margin-bottom:15px">
                        <input type="color" value="${emb.color}" oninput="updateEmbed(${i}, 'color', this.value)" style="width:50px; height:25px; cursor:pointer">
                        ${i > 0 ? `<button onclick="removeEmbed(${i})" style="background:none; border:none; color:var(--danger); cursor:pointer">üóëÔ∏è Sil</button>` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group"><label>Yazar ƒ∞smi</label><input type="text" value="${emb.author}" oninput="updateEmbed(${i}, 'author', this.value)"></div>
                        <div class="form-group"><label>Yazar ƒ∞kon (URL)</label><input type="text" value="${emb.authorIcon}" oninput="updateEmbed(${i}, 'authorIcon', this.value)"></div>
                    </div>

                    <div class="form-group"><label>Ba≈ülƒ±k</label><input type="text" value="${emb.title}" oninput="updateEmbed(${i}, 'title', this.value)"></div>
                    <div class="form-group"><label>A√ßƒ±klama</label><textarea rows="2" oninput="updateEmbed(${i}, 'description', this.value)">${emb.description}</textarea></div>
                    
                    <div class="form-row">
                        <div class="form-group"><label>Thumbnail (URL)</label><input type="text" value="${emb.thumbnail}" oninput="updateEmbed(${i}, 'thumbnail', this.value)"></div>
                        <div class="form-group"><label>B√ºy√ºk Resim (URL)</label><input type="text" value="${emb.image}" oninput="updateEmbed(${i}, 'image', this.value)"></div>
                    </div>

                    <div class="form-group"><label>Alt Bilgi (Footer)</label><input type="text" value="${emb.footer}" oninput="updateEmbed(${i}, 'footer', this.value)"></div>

                    <button class="tool-btn" style="width:100%; margin-bottom:10px" onclick="openModal(${i})">+ Yeni Alan (Field) Ekle</button>
                    <div id="fields-${i}">${emb.fields.map((f, fi) => `<div style="font-size:11px; background:rgba(255,255,255,0.05); padding:8px; border-radius:4px; margin-bottom:5px; display:flex; justify-content:space-between"><span><b>${f.name}</b></span><span onclick="embedData[${i}].fields.splice(${fi},1); renderEditor(); renderPreview(); debouncedSave()" style="color:var(--danger); cursor:pointer">‚úï</span></div>`).join('')}</div>
                </div>`;
        });
    }

    function renderPreview() {
        document.getElementById('p-content').textContent = document.getElementById('main-content').value;
        const list = document.getElementById('p-embed-list');
        list.innerHTML = '';
        embedData.forEach(emb => {
            let fHtml = emb.fields.map(f => `<div style="margin-top:10px"><div style="color:#fff; font-weight:600; font-size:13px">${f.name}</div><div style="color:#dcddde; font-size:13px">${f.value}</div></div>`).join('');
            list.innerHTML += `
                <div class="embed-card" style="border-left-color: ${emb.color}">
                    ${emb.author ? `<div class="e-author">${emb.authorIcon ? `<img src="${emb.authorIcon}">`:''}${emb.author}</div>` : ''}
                    ${emb.thumbnail ? `<img src="${emb.thumbnail}" class="e-thumbnail">` : ''}
                    <div class="e-title">${emb.title}</div>
                    <div class="e-desc">${emb.description}</div>
                    <div style="display:grid; grid-template-columns:1fr 1fr">${fHtml}</div>
                    ${emb.image ? `<img src="${emb.image}" class="e-image">` : ''}
                    ${emb.footer ? `<div class="e-footer">${emb.footer}</div>` : ''}
                </div>`;
        });
    }

    // JSON Export/Import
    function exportData() {
        const data = { embedData, content: document.getElementById('main-content').value };
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `maho_architect_${Date.now()}.json`;
        a.click();
        showToast("Dosya indirildi");
    }

    function importData(input) {
        const file = input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                embedData = data.embedData;
                document.getElementById('main-content').value = data.content;
                renderEditor(); renderPreview(); saveState();
                showToast("Tasarƒ±m y√ºklendi!");
            } catch(err) { showToast("Ge√ßersiz JSON!", "error"); }
        };
        reader.readAsText(file);
    }

    // Webhook G√∂nderimi
    async function sendWebhook() {
        const url = document.getElementById('hook-url').value;
        if(!url) return showToast("Webhook URL Gerekli!", "error");
        
        const payload = {
            content: document.getElementById('main-content').value,
            embeds: embedData.map(e => ({
                title: e.title, description: e.description,
                color: parseInt(e.color.replace('#',''), 16),
                author: e.author ? { name: e.author, icon_url: e.authorIcon } : null,
                thumbnail: e.thumbnail ? { url: e.thumbnail } : null,
                image: e.image ? { url: e.image } : null,
                footer: e.footer ? { text: e.footer } : null,
                fields: e.fields
            }))
        };

        try {
            const res = await fetch(url, { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify(payload) 
            });
            if(res.ok) showToast("Webhook ba≈üarƒ±yla g√∂nderildi!"); 
            else showToast("Hata: " + res.status, "error");
        } catch(e) { showToast("Baƒülantƒ± Hatasƒ±!", "error"); }
    }

    // Ba≈ülangƒ±√ß Ayarlarƒ±
    window.onload = () => {
        const backup = localStorage.getItem('maho_architect_backup');
        if(backup) {
            const data = JSON.parse(backup);
            embedData = data.embedData;
            document.getElementById('main-content').value = data.content;
            document.getElementById('hook-url').value = data.hookUrl || '';
        }
        setInterval(() => {
            const d = new Date();
            document.getElementById('live-clock').textContent = `Bug√ºn ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
        }, 1000);
        renderEditor(); renderPreview(); saveState();
    };
</script>
</body>
</html>